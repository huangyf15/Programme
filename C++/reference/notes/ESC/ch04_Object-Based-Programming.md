# 第四章 基于对象的编程风格

> Last updated: Aug 30, 2020
>
> Author: Yunfan Huang

### 本章内容

学习设计和实现简单的（这里指不涉及继承关系的）自定义类，它由两部分组成：一组公开的操作函数和运算符，以及一组私有的实现细节。

* 类的实现细节可由成员函数的定义以及与此类相关的任何数据组成，而类的用户通常不会关心此等实现细节。
* 用户只利用类的公开接口进行编程，此时只要接口没有更改，即使实现细节重新改造，所有的应用程序代码也不需要变动。

主要内容包括：

* 类的基本构成及操作：成员函数和内联成员函数，构造函数和析构函数，`this`指针，拷贝赋值操作
* 类的成员类型及访问：类的`mutable`和`const`成员，类的静态成员，友元函数和友元类
* 类的运算符重载：iterator class 相关（`!=, *, ++`），iostream class 相关（`<<, >>`），函数对象（`()`）
* 基于成员函数指针的多态：嵌套类型，指向类的成员函数的指针

#### 程序案例

* `stack_nonT`：简单类的实现（以非模板版本的 stack 类为例）
* `triang_seq`：类的基本构成及操作，类的成员类型及访问，类的运算符重载（除`()`以外）
* `less_than`：函数对象的实现
* `cal_seq_Cbased`：基于成员函数指针的多态（指向类的成员函数的指针）

### 类的声明和定义

* 前置声明使得可以进行类指针（class pointer）的定义，或以此 class 作为数据类型，但注意**不能使用类的细节**。
* 设计类时必须确认在此类上及逆行“成员逐一初始化/复制”的行为模式是否适当，如果答案肯定就不必另外提供拷贝构造函数；否则必须另外提供。
  * 如果有必要为某个类编写拷贝构造函数（copy constructor），那么同样有必要为它编写拷贝赋值操作（copy assignment operator）。
* `static/inline`成员的声明、定义和初始化**注意事项**
  * 类似`buffer_size`这类的`const static int`数据成员，可以在声明时为其明确指定初值，但建议将其声明为枚举类型。
  * 作为成员函数的运算符重载函数一般声明为内联的，要注意**内联函数必须放在头文件中**，其依赖的函数也必须置于头文件中，否则会找不到定义。
  * 类内的`static`成员（无论私有还是公有）在头文件声明后，必须在程序代码文件`.cpp`中给出定义，否则会找不到定义。
* function call 运算符可以接受任意个数的参数，比如可以用来支持`Matrix`的多维度下标操作，因为语言所提供的下标运算符仅能接受一个参数。

### 基于成员函数指针的多态

* `obj.*pf`/`pobj->*pf`是针对**类对象**`obj`/**指向类对象的指针**`pobj`的 pointer to member selection 运算符，可用于通过函数指针`pf`调用`obj`的成员函数。