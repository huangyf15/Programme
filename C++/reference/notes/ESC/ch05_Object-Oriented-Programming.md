# 第五章 面向对象编程风格

> Last updated: Aug 31, 2020
>
> Author: Yunfan Huang

### 本章内容

学习设计和实现相对复杂的（这里指涉及继承的）自定义类以及基于抽象基类指针的多态，主要内容包括：

* 面向对象编程的概念及思想：继承，多态，动态绑定
* 类的继承和派生：基类和派生类，继承体系，初始化、析构、复制
* 基于抽象基类指针的多态：抽象基类，虚函数和纯虚函数，运行时类型鉴定（RTTI）

#### 程序案例

* `lib_mat`：类的继承和派生基础

### 面向对象编程

#### 基于成员函数指针的多态

劣势：每加入或删除某个数列类型，以下事物都必须正确地予以更新

* `num_seq`的值，`ns_type`包含的枚举值，`set_sequence()`的`switch`语句
* `seq_name()`字符串数组，`seq_type`映射
* 数列函数的声明及定义，指向成员函数的指针所形成的数组`func_tbl`，储存数列元素的向量`seq`

#### 面向对象编程的特点

* 继承：将一群相关的类组织起来，并分享其间的共通数据和操作行为
* 多态：用一种与类型无关的方式（即使用抽象基类的指针或引用）来操作这些类对象
* 动态绑定：通过抽象基类的指针或引用在运行时才确定其所指的实际对象的类型
  * 优势：可以在不更动旧有程序的前提下，加入或移除任何一个派生类

### 基于抽象基类指针的多态

* 定义抽象类的步骤
  * 第一步：找出所有子类共通的操作行为，作为基类的公共接口
  * 第二步：找出哪些操作行为与类型相关，将其声明为类继承体系中的虚函数
  * 第三步：找出每个操作行为的访问层级，声明为`public/private/protected`
* 注意事项

  * 当不必等到运行时才进行解析时，建议通过 class scope 运算符`::`指明调用对象的类型
  * 类的引用/指针数据成员
  * 若类的数据成员是引用，则必须在构造函数中的初始化列表中加以初始化，且一旦初始化就无法指向另一个对象，因此不必检查是否为空
    * 若类的数据成员是指针，就既可以直接在构造函数内加以初始化，也可以先将它初始化为`nullptr`，稍后再令它指向某个有效的内存地址
  * 虚函数的静态解析
    * 基类的构造函数和析构函数内，派生类的虚函数绝对不会被调用，而会调用基类的那一份虚函数
    * 使用基类对象而非其指针或引用时，派生类新增的子对象被切掉了，因此无法调用相应的虚函数
  
  
